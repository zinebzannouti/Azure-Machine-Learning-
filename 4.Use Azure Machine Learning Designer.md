# Use Azure Machine Learning Designer :

**Le concepteur Azure Machine Learning fournit un environnement de glisser-d√©poser dans lequel vous pouvez d√©finir un flux de travail ou un pipeline de composants d'ingestion, de transformation et de formation de mod√®le de donn√©es pour cr√©er un mod√®le d'apprentissage automatique. Vous pouvez ensuite publier ce pipeline en tant que service Web que les applications clientes peuvent utiliser pour l'inf√©rence (g√©n√©ration de pr√©dictions √† partir de nouvelles donn√©es).**

## 1 -Create a designer pipeline

**Pour d√©marrer avec le concepteur(designer), vous devez d'abord cr√©er un pipeline et ajouter l'ensemble de donn√©es avec lequel vous souhaitez travailler.**

- *Dans Azure Machine Learning Studio, affichez la page Designer et cr√©ez un nouveau pipeline.*

![a](https://user-images.githubusercontent.com/78825764/207336618-8bcce81e-ed95-4959-a46a-1439dd820d14.PNG)

- *Go to Settings > Select Azure ML compute cluster > Selectionner votre compute cluster* 

![a](https://user-images.githubusercontent.com/78825764/207341835-0915f33d-e3d8-427b-af27-07f95c5ab4a8.PNG)

- *Sur le c√¥t√© gauche du concepteur, s√©lectionnez l'onglet Donn√©es et faites glisser l'ensemble de donn√©es diabetes sur le canevas.*


![a](https://user-images.githubusercontent.com/78825764/207344966-22895f51-28a2-4588-8fb9-87f793b9f1e8.PNG)

- * Right click sur diabetes dataset > Preview data*


![a](https://user-images.githubusercontent.com/78825764/207349833-1d2912fc-623f-4477-8221-64394a714630.PNG)

- *Passez en revue le sch√©ma des donn√©es, en notant que vous pouvez voir les distributions des diff√©rentes colonnes sous forme d'histogrammes. Fermez ensuite la visualisation.*

![a](https://user-images.githubusercontent.com/78825764/207351644-51ff4395-06b4-420a-ba71-3111ad65896c.PNG)

## 2- Add transformations

**Avant de pouvoir entra√Æner un mod√®le, vous devez g√©n√©ralement appliquer certaines transformations de pr√©traitement aux donn√©es.**

- *Dans le volet de gauche, s√©lectionnez l'onglet Component, qui contient une large gamme de composants que vous pouvez utiliser pour transformer les donn√©es avant l'apprentissage du mod√®le. Vous pouvez rechercher des composants en haut du volet.*

- *Recherchez le composant Normalize Data et faites-le glisser vers le canevas, sous le composant de l'ensemble de donn√©es . Connectez ensuite la sortie du composant de l'ensemble de donn√©es diabetes √† l'entr√©e du composant Normalize Data.*


![a](https://user-images.githubusercontent.com/78825764/207354744-dc7586ac-72fd-4a68-b863-baa2c6876c0e.PNG)

![AA](https://user-images.githubusercontent.com/78825764/207357438-abd9b671-c6df-4ee2-bfdc-8626ce8407aa.PNG)

- *S√©lectionnez le composant Normalize Data et affichez ses param√®tres, en notant qu'il vous oblige √† sp√©cifier la m√©thode de transformation et les colonnes √† transformer. Ensuite, en laissant la transformation en tant que ZScore, modifiez les colonnes pour inclure les noms de colonne suivants¬†:*
    - PlasmaGlucose
    - DiastolicBloodPressure
    - TricepsThickness
    - SerumInsulin
    - BMI
    - DiabetesPedigree

![a](https://user-images.githubusercontent.com/78825764/207357825-42a108a6-133b-4c69-8bbd-e5cad1570cc6.PNG)

- *Nous sommes maintenant pr√™ts √† diviser les donn√©es en ensembles de donn√©es distincts pour le training et la validation. Dans le volet de gauche, recherchez le composant **Split Data** et faites-le glisser sur le canevas sous le composant Normaliser les donn√©es. Connectez ensuite la sortie Transformed Dataset (gauche) du composant Normalize Data √† l'entr√©e du composant Split Data.*

![a](https://user-images.githubusercontent.com/78825764/207359978-256050ec-33e8-4990-9331-ede055c5c199.PNG)

- *S√©lectionnez le composant Split Data  et configurez ses param√®tres comme suit :*

    - **Splitting mode** Split Rows
    - **Fraction of rows in the first output dataset** 0.7
    - **Random seed:** 123
    - **Stratified split:** False
![a](https://user-images.githubusercontent.com/78825764/207365553-00ed13f5-416e-4a40-8e57-f16d06c6ab00.PNG)

## 3-Add model training components

**Une fois les donn√©es pr√©par√©es et divis√©es en jeux de donn√©es de formation et de validation, vous √™tes pr√™t √† configurer le pipeline pour former et √©valuer un mod√®le.**

- *Recherchez le composant Train Model et faites-le glisser sur le canevas, sous le composant Split Data. Connectez ensuite la sortie Result dataset1 (gauche) du composant Split Data √† l'entr√©e Dataset (droite) du composant Train Model.*


![a](https://user-images.githubusercontent.com/78825764/207366271-27d29d74-b456-4cee-b0f0-b93576d68abe.PNG)

- *Le mod√®le que nous formons pr√©dira la valeur Diabetic, alors s√©lectionnez le composant Train Model et modifiez ses param√®tres pour d√©finir la colonne Label sur Diabetic*


![a](https://user-images.githubusercontent.com/78825764/207367058-f7cafd95-7ade-4bcd-8e05-71b51631007c.PNG)

- *La label Diabetic que le mod√®le pr√©dira est une colonne binaire (1 pour les patients atteints de diab√®te, 0 pour les patients qui n'en ont pas), nous devons donc entra√Æner le mod√®le √† l'aide d'un algorithme de classification. Recherchez le composant **Two-Class Logistic Regression** et faites-le glisser sur le canevas, √† gauche du composant Split Data et au-dessus du composant Train Model. Connectez ensuite sa sortie √† l'entr√©e Untrained model (gauche) du composant Train Model.*


![a](https://user-images.githubusercontent.com/78825764/207368073-4215be6a-ff99-4fda-ac3e-40d8c3e88875.PNG)

- *Pour tester le mod√®le entra√Æn√©, nous devons l'utiliser pour √©valuer l'ensemble de donn√©es de validation que nous avons retenu lorsque nous avons divis√© les donn√©es d'origine. Recherchez le composant **Score Model** et faites-le glisser et d√©posez-le sur le canevas, sous le composant Train Model. Connectez ensuite la sortie du composant Train Model √† l'entr√©e Trained model (gauche) du composant Score Model ; et faites glisser la sortie Results dataset2 (droite) du composant Split Data vers l'entr√©e Dataset (droite) du composant Score Model.*

![a](https://user-images.githubusercontent.com/78825764/207368892-7b8e3b53-8317-4c9a-ba9e-1c5c1fdb427b.PNG)

- *Pour √©valuer les performances du mod√®le, nous devons examiner certaines mesures g√©n√©r√©es par la notation de l'ensemble de donn√©es de validation. Recherchez le composant **Evaluate Model** et faites-le glisser vers le canevas, sous le composant Score Model, et connectez la sortie du composant Score Model √† l'entr√©e Score dataset (gauche) du composant Evaluate Model.*

![a](https://user-images.githubusercontent.com/78825764/207369422-d7485e6c-7b7b-484f-a409-34c403fcb64a.PNG)


## 4-Run the training pipeline


**Une fois les √©tapes de flux de donn√©es d√©finies, vous √™tes maintenant pr√™t √† ex√©cuter le pipeline de training et √† entrainer le mod√®le.**

- *V√©rifiez que votre pipeline ressemble √† ce qui suit¬†:*


![a](https://user-images.githubusercontent.com/78825764/207370606-f2099a77-2cea-4889-af55-7377100bc14b.PNG)

- *En haut √† droite, cliquez sur Submit. Ensuite, lorsque vous y √™tes invit√©, cr√©ez une nouvelle exp√©rience nomm√©e mslearn-designer-train-diabetes et ex√©cutez-la. Cela initialisera le cluster de calcul, puis ex√©cutera le pipeline, ce qui peut prendre 10¬†minutes ou plus. Vous pouvez voir l'√©tat du pipeline ex√©cut√© en haut √† droite du canevas de conception.*


![a](https://user-images.githubusercontent.com/78825764/207371475-5f99073f-ca56-4bdb-bb42-c30fe4182809.PNG)

- *Click on Submit and wait*

![a](https://user-images.githubusercontent.com/78825764/207371690-231c3277-9871-43d2-9b40-62a9f1ba834b.PNG)

- *Cliquer sur job detail*

![a](https://user-images.githubusercontent.com/78825764/207406265-56dfae6f-e4f7-4422-a3de-1eee793ed316.PNG)

![a](https://user-images.githubusercontent.com/78825764/207406862-0e42241e-8180-49e2-a95e-c8e08d36da14.PNG)



- *S√©lectionnez le le composant Normalisze Data et, dans le volet Param√®tres, dans l'onglet Outputs + Logs, sous Sorties de donn√©es dans la section Transformed dataset, cliquez sur l'ic√¥ne Preview data et notez que vous pouvez afficher les statistiques et les visualisations de distribution pour les colonnes transform√©es.*

![a](https://user-images.githubusercontent.com/78825764/207407692-a2e6be9f-45ce-47fe-8c49-ca363cea6162.PNG)

![a](https://user-images.githubusercontent.com/78825764/207407930-9c6b4c4f-37bf-4f35-b306-dedf226c2493.PNG)


- *Fermez les visualisations Normalize Data et attendez que les autres composants soient termin√©s. Visualisez ensuite la sortie du composant Evaluate Model  pour afficher les m√©triques de performances du mod√®le.*

![a](https://user-images.githubusercontent.com/78825764/207408213-6ba8c9c5-07ac-4bf9-ba87-deb7146a394a.PNG)



üì¢üì¢üì¢**Remarque :** Les performances de ce mod√®le ne sont pas si bonnes, en partie parce que nous n'avons effectu√© qu'un minimum d'ing√©nierie et de pr√©traitement des fonctionnalit√©s. Vous pouvez essayer diff√©rents algorithmes de classification et comparer les r√©sultats (vous pouvez connecter les sorties du composant Split Data √† plusieurs composants Train Model et Score Model, et vous pouvez connecter un deuxi√®me mod√®le not√© au composant Evaluate Model pour voir un side-by -comparaison lat√©rale). Le but de l'exercice est simplement de vous pr√©senter l'interface du concepteur, pas de former un mod√®le parfait¬†!


## 5-Create an inference pipeline

- *S√©lectionnez Create inference pipeline, puis cliquez sur real-time inference pipeline. Apr√®s quelques secondes, une nouvelle version de votre pipeline nomm√©e Visual Diabetes Training-real time inference sera ouverte.*



![a](https://user-images.githubusercontent.com/78825764/207409265-85b498a1-5efe-4231-877d-4053dd9199b7.PNG)

- *Examiner le nouveau pipeline. Notez que la transformation de normalisation et le mod√®le entra√Æn√© ont √©t√© encapsul√©s dans ce pipeline afin que les statistiques de vos donn√©es d'entra√Ænement soient utilis√©es pour normaliser toutes les nouvelles valeurs de donn√©es, et le mod√®le entra√Æn√© soit utilis√© pour noter les nouvelles donn√©es.*

![a](https://user-images.githubusercontent.com/78825764/207410004-889ca5ad-6c06-4eb7-9d93-0cc44939e798.PNG)

- *Notez que le pipeline d'inf√©rence suppose que les nouvelles donn√©es correspondront au sch√©ma des donn√©es d'entra√Ænement d'origine, de sorte que l'ensemble de donn√©es sur le diab√®te du pipeline d'entra√Ænement est inclus. Cependant, ces donn√©es d'entr√©e incluent l'√©tiquette Diabetic que le mod√®le pr√©dit, qu'il n'est pas intuitif d'inclure dans les nouvelles donn√©es de patients pour lesquelles une pr√©diction de diab√®te n'a pas encore √©t√© faite.*

- *Supprimez l'ensemble de donn√©es Diabetes dataset du pipeline d'inf√©rence et remplacez-le par un composant **Enter Data Manually**¬†; en le connectant √† la m√™me entr√©e d'ensemble de donn√©es du composant Apply Transformation que l'entr√©e de service Web. Modifiez ensuite les param√®tres du composant Enter Data Manually pour utiliser l'entr√©e CSV suivante, qui inclut des valeurs de caract√©ristiques sans √©tiquettes pour trois nouvelles observations de patients¬†:*

```
PatientID,Pregnancies,PlasmaGlucose,DiastolicBloodPressure,TricepsThickness,SerumInsulin,BMI,DiabetesPedigree,Age
1882185,9,104,51,7,24,27.36983156,1.350472047,43
1662484,6,73,61,35,24,18.74367404,1.074147566,75
1228510,4,115,50,29,243,34.69215364,0.741159926,59
```

![a](https://user-images.githubusercontent.com/78825764/207412226-792bfe46-beb1-4922-813f-d6b0f657fc09.PNG)

![a](https://user-images.githubusercontent.com/78825764/207412291-5de0db4c-220c-46fa-84c6-1c94bd0b2394.PNG)


- *La sortie du composant Score Model inclut toutes les caract√©ristiques d'entr√©e ainsi que l'√©tiquette pr√©dite et le score de probabilit√©. Pour limiter la sortie uniquement √† la pr√©diction et √† la probabilit√©, supprimez la connexion entre le composant Score Model et la sortie du service Web*

![a](https://user-images.githubusercontent.com/78825764/207412795-5293b919-bdc7-416f-a0f1-44fd0b73fcb6.PNG)

- *ajoutez un composant Execute Python Script. Connectez la sortie du composant Score Model √† l'entr√©e Dataset1 (la plus √† gauche) du script Execute Python, et connectez la sortie du composant Execute Python Script √† la sortie du service Web.*



![a](https://user-images.githubusercontent.com/78825764/207413635-734dfb2e-0506-4a46-869d-41cce4b81c70.PNG)

- *Le pipeline d'inf√©rence inclut le composant Evaluate Model, qui n'est pas utile lors de la pr√©diction √† partir de nouvelles donn√©es, supprimez donc ce composant.*

![a](https://user-images.githubusercontent.com/78825764/207413838-abd1d56c-5052-4012-9666-a441f75e61b9.PNG)

- *Modifiez ensuite les param√®tres du composant Execute Python Script pour utiliser le code suivant (en rempla√ßant tout le code existant)¬†:*

```
import pandas as pd

def azureml_main(dataframe1 = None, dataframe2 = None):

    scored_results = dataframe1[['PatientID', 'Scored Labels', 'Scored Probabilities']]
    scored_results.rename(columns={'Scored Labels':'DiabetesPrediction',
                                    'Scored Probabilities':'Probability'},
                            inplace=True)
    return scored_results
```

![a](https://user-images.githubusercontent.com/78825764/207414676-5644da9b-9da6-4609-8625-a94761d58ff8.PNG)

- *Soumettez le pipeline en tant que nouvelle exp√©rience nomm√©e mslearn-designer-predict-diabetes sur le cluster de calcul que vous avez utilis√© pour la formation. Cela peut prendre un peu de temps!*

![a](https://user-images.githubusercontent.com/78825764/207415420-54b40a11-84d4-433d-957c-40b4224c2dd7.PNG)

- *Cliquer sur job detail*


![a](https://user-images.githubusercontent.com/78825764/207417974-8960122c-2d8f-40a1-8c9b-7762bbffdc0a.PNG)

## 6-Deploy the inference pipeline as a web service

**Vous disposez maintenant d'un pipeline d'inf√©rence pour l'inf√©rence en temps r√©el, que vous pouvez d√©ployer en tant que service Web pour les applications clientes.**

- **En haut √† droite, cliquez sur Deploy et d√©ployez un nouveau point de terminaison en temps r√©el √† l'aide des param√®tres suivants¬†:**
    
    -  **Name:** designer-predict-diabetes
    - **Description:** Predict diabetes.
    - **Compute type:** Azure Container Instance

![a](https://user-images.githubusercontent.com/78825764/207420027-d616292b-33b9-4a94-9730-33e088e4dd58.PNG)

- *Attendez que le service Web soit d√©ploy√© - cela peut prendre plusieurs minutes. L'√©tat du d√©ploiement est affich√© en haut √† gauche de l'interface du concepteur.*

## 7-Test the web service :

**Vous pouvez maintenant tester votre service d√©ploy√© √† partir d'une application cliente - dans ce cas, vous utiliserez un notebook.**

- *Sur la page Endpoints, ouvrez l'endpoint en temps r√©el designer-predict-diabetes.*

![a](https://user-images.githubusercontent.com/78825764/207421518-1456dd9e-3ce8-4108-a81a-3185173ea415.PNG)

